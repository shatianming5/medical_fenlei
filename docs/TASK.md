# 任务定义与模型选择

## 任务是什么？

这是一个 **医学影像诊断分类** 任务：输入为颞骨/耳部 CT 的 DICOM 序列（3D 体数据），输出为 **同一次检查的左/右两只耳朵的诊断类别（双输出）**。

本项目把一次检查的序列按图像宽度一分为二得到左右耳区域（右耳默认做水平翻转以对齐方向），然后做 **双输出** 的 6 分类（左耳一个分类头、右耳一个分类头；共享 backbone）：

| 类别 ID | 标注代码 | 名称 |
|---:|---:|---|
| 0 | 1 | 慢性化脓性中耳炎 |
| 1 | 2 | 中耳胆脂瘤 |
| 2 | 3 | 分泌性中耳炎 |
| 3 | 4 | 胆固醇肉芽肿 |
| 4 | 5 | 正常 |
| 5 | 6 | 其他 |

标注来源：`metadata/导出数据第1~4017条数据20240329-To模型训练团队.xlsx`（仅本地使用，不入库）。

## 为什么要做 1% / 20% / 100% 三层？

用于观察 **数据量缩放** 对模型效果的影响，并快速验证 pipeline：

- 1%：最小可跑通/快速迭代
- 20%：中等规模，用于模型对比
- 100%：最终训练

本项目使用 `scripts/make_splits_dual.py` 对训练集做 **按类别分层等比例抽样**（按“耳朵标签”计数；选择 exam_id 子集），验证集按 exam_id 切分固定不变，避免左右耳泄漏，便于公平对比。

## 模型选什么？

数据是 CT 体数据（3D），但体数据训练开销大；因此建议从轻到重：

`dual_resnet10_3d`（推荐默认）
- 做法：把左右耳分别裁剪成 (C=1, D=K, H, W) 体数据，用 **同一个** MONAI 3D ResNet10 分别前向（batch 维度拼接），输出 (left,right) 两个 logits
- 优点：符合 3D CT 数据形态，且天然对齐“左右耳各自诊断”的标注方式
- 入口：`scripts/train_dual.py`

说明：仓库仍保留单耳样本的 `scripts/train_side.py`/`scripts/predict_side.py` 作为对照/回退，但默认以双输出为主。
